<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional banana sales management system - GitHub Pages Demo">
    <meta name="keywords" content="banana sales, inventory management, business management">
    <meta name="author" content="Banana Sales Manager">
    <meta name="theme-color" content="#10b981">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüçå%3C/text%3E%3C/svg%3E">
    <title>Banana Sales Manager - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script type="module">
        // GitHub Pages Demo Configuration (using localStorage)
        let isConnected = true; // Simulate connection for demo
        let salesData = [];
        
        // Load data from localStorage
        function loadSalesData() {
            const stored = localStorage.getItem('banana_sales_data');
            if (stored) {
                salesData = JSON.parse(stored);
            } else {
                // Initialize with sample data
                salesData = [
                    {
                        id: 'demo_1',
                        customer_name: 'John Doe',
                        quantity: 50,
                        price_per_kg: 2.50,
                        total_amount: 125.00,
                        sale_date: new Date().toISOString().split('T')[0],
                        payment_method: 'cash',
                        notes: 'Demo sale record',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: 'demo_2',
                        customer_name: 'Jane Smith',
                        quantity: 30,
                        price_per_kg: 2.75,
                        total_amount: 82.50,
                        sale_date: new Date().toISOString().split('T')[0],
                        payment_method: 'card',
                        notes: 'Regular customer',
                        created_at: new Date().toISOString()
                    }
                ];
                saveSalesData();
            }
        }
        
        // Save data to localStorage
        function saveSalesData() {
            localStorage.setItem('banana_sales_data', JSON.stringify(salesData));
        }
        
        // Simulate API functions with localStorage
        async function apiRequest(endpoint, options = {}) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const method = options.method || 'GET';
            const body = options.body ? JSON.parse(options.body) : null;
            
            if (endpoint === '/health') {
                return { status: 'ok', message: 'Demo mode - using localStorage' };
            }
            
            if (endpoint === '/sales') {
                if (method === 'GET') {
                    return salesData;
                } else if (method === 'POST') {
                    const newSale = {
                        ...body,
                        id: 'demo_' + Date.now(),
                        created_at: new Date().toISOString()
                    };
                    salesData.push(newSale);
                    saveSalesData();
                    return newSale;
                }
            }
            
            if (endpoint.startsWith('/sales/')) {
                const id = endpoint.split('/')[2];
                const saleIndex = salesData.findIndex(sale => sale.id === id);
                
                if (method === 'GET') {
                    return salesData[saleIndex] || null;
                } else if (method === 'PUT') {
                    if (saleIndex !== -1) {
                        salesData[saleIndex] = { ...salesData[saleIndex], ...body };
                        saveSalesData();
                        return salesData[saleIndex];
                    }
                } else if (method === 'DELETE') {
                    if (saleIndex !== -1) {
                        salesData.splice(saleIndex, 1);
                        saveSalesData();
                        return { success: true };
                    }
                }
            }
            
            if (endpoint === '/sales/summary') {
                const totalSales = salesData.length;
                const totalRevenue = salesData.reduce((sum, sale) => sum + sale.total_amount, 0);
                const totalQuantity = salesData.reduce((sum, sale) => sum + sale.quantity, 0);
                const avgPrice = totalQuantity > 0 ? totalRevenue / totalQuantity : 0;
                
                return {
                    total_sales: totalSales,
                    total_revenue: totalRevenue,
                    total_quantity: totalQuantity,
                    average_price: avgPrice
                };
            }
            
            throw new Error('Endpoint not found');
        }
        
        // Initialize data
        loadSalesData();
        
        // Make functions globally available
        window.apiRequest = apiRequest;
        window.isConnected = isConnected;
        
        // Simulate WebSocket connection (not needed for demo)
        window.websocket = {
            send: () => {},
            close: () => {}
        };
    </script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Demo Notice Banner -->
    <div class="bg-yellow-100 border-b border-yellow-200 px-4 py-2">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <span class="text-yellow-600">‚ö†Ô∏è</span>
                <span class="text-yellow-800 text-sm font-medium">Demo Mode</span>
                <span class="text-yellow-700 text-sm">Data is stored locally in your browser</span>
            </div>
            <a href="https://github.com/Pansinas/banana-sales-manager" target="_blank" class="text-yellow-700 hover:text-yellow-900 text-sm underline">
                View on GitHub
            </a>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl">üçå</div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Banana Sales Manager</h1>
                        <p class="text-sm text-gray-500">Professional sales tracking system</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <span class="text-sm text-gray-600">Demo Mode</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="text-2xl mr-3">üìä</div>
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Sales</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-sales">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="text-2xl mr-3">üí∞</div>
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Revenue</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-revenue">$0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="text-2xl mr-3">‚öñÔ∏è</div>
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Quantity</p>
                        <p class="text-2xl font-bold text-gray-900" id="total-quantity">0 kg</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="text-2xl mr-3">üìà</div>
                    <div>
                        <p class="text-sm font-medium text-gray-600">Avg Price</p>
                        <p class="text-2xl font-bold text-gray-900" id="avg-price">$0/kg</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Sale Form -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Add New Sale</h2>
            </div>
            <div class="p-6">
                <form id="sale-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                        <input type="text" id="customer-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity (kg)</label>
                        <input type="number" id="quantity" required min="0" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price per kg ($)</label>
                        <input type="number" id="price-per-kg" required min="0" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Sale Date</label>
                        <input type="date" id="sale-date" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
                        <select id="payment-method" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="">Select method</option>
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="transfer">Bank Transfer</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Total Amount ($)</label>
                        <input type="number" id="total-amount" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50">
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    <div class="md:col-span-2 lg:col-span-3">
                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                            Add Sale
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sales List -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Recent Sales</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price/kg</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sales-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Sales will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            document.getElementById('sale-date').value = new Date().toISOString().split('T')[0];
            
            // Calculate total amount when quantity or price changes
            const quantityInput = document.getElementById('quantity');
            const priceInput = document.getElementById('price-per-kg');
            const totalInput = document.getElementById('total-amount');
            
            function calculateTotal() {
                const quantity = parseFloat(quantityInput.value) || 0;
                const price = parseFloat(priceInput.value) || 0;
                totalInput.value = (quantity * price).toFixed(2);
            }
            
            quantityInput.addEventListener('input', calculateTotal);
            priceInput.addEventListener('input', calculateTotal);
            
            // Handle form submission
            document.getElementById('sale-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    customer_name: document.getElementById('customer-name').value,
                    quantity: parseFloat(document.getElementById('quantity').value),
                    price_per_kg: parseFloat(document.getElementById('price-per-kg').value),
                    total_amount: parseFloat(document.getElementById('total-amount').value),
                    sale_date: document.getElementById('sale-date').value,
                    payment_method: document.getElementById('payment-method').value,
                    notes: document.getElementById('notes').value
                };
                
                try {
                    await apiRequest('/sales', {
                        method: 'POST',
                        body: JSON.stringify(formData)
                    });
                    
                    // Reset form
                    this.reset();
                    document.getElementById('sale-date').value = new Date().toISOString().split('T')[0];
                    
                    // Refresh data
                    await loadSalesData();
                    await updateSummary();
                    
                    alert('Sale added successfully!');
                } catch (error) {
                    alert('Error adding sale: ' + error.message);
                }
            });
            
            // Load initial data
            loadSalesData();
            updateSummary();
        });
        
        // Load and display sales data
        async function loadSalesData() {
            try {
                const sales = await apiRequest('/sales');
                const tbody = document.getElementById('sales-table-body');
                
                tbody.innerHTML = sales.map(sale => `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${sale.customer_name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.quantity} kg</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${sale.price_per_kg.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$${sale.total_amount.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.sale_date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.payment_method}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="deleteSale('${sale.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading sales:', error);
            }
        }
        
        // Update summary statistics
        async function updateSummary() {
            try {
                const summary = await apiRequest('/sales/summary');
                
                document.getElementById('total-sales').textContent = summary.total_sales;
                document.getElementById('total-revenue').textContent = `$${summary.total_revenue.toFixed(2)}`;
                document.getElementById('total-quantity').textContent = `${summary.total_quantity} kg`;
                document.getElementById('avg-price').textContent = `$${summary.average_price.toFixed(2)}/kg`;
            } catch (error) {
                console.error('Error updating summary:', error);
            }
        }
        
        // Delete sale
        async function deleteSale(id) {
            if (confirm('Are you sure you want to delete this sale?')) {
                try {
                    await apiRequest(`/sales/${id}`, { method: 'DELETE' });
                    await loadSalesData();
                    await updateSummary();
                    alert('Sale deleted successfully!');
                } catch (error) {
                    alert('Error deleting sale: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>